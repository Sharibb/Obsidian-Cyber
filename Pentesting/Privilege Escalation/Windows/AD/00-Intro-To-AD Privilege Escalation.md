write a extensive introduction common techniques and lateral horizantal types and moving along with machines


# **Introduction to Active Directory Privilege Escalation**  

Active Directory (AD) is a critical component of Windows-based networks, managing users, computers, and permissions across an enterprise. Attackers often target AD to escalate privileges, move laterally, and gain control over the entire domain. Understanding privilege escalation techniques is essential for both penetration testers and defenders.  

This guide covers **common privilege escalation methods**, **lateral movement techniques**, and how attackers traverse machines in an AD environment.  

---

## **1. Common Privilege Escalation Techniques**  

Privilege escalation in AD can be categorized into:  
- **Vertical Escalation (Elevating Privileges)** – Gaining higher-level access (e.g., moving from a standard user to Domain Admin).  
- **Horizontal Escalation (Lateral Movement)** – Moving between accounts with similar privileges but different access paths.  

### **A. Vertical Privilege Escalation Methods**  

#### **(1) Misconfigured Permissions & Weak ACLs**  
- Attackers exploit misconfigured access control lists (ACLs) on AD objects like:  
  - **User/Group Objects** – Adding themselves to privileged groups (`Domain Admins`, `Enterprise Admins`).  
  - **GPOs (Group Policy Objects)** – Modifying GPOs to execute malicious scripts on target machines.  
  - **Service Accounts** – Abusing weak service permissions (`SeImpersonatePrivilege`, `SeDebugPrivilege`).  

#### **(2) Kerberoasting & AS-REP Roasting**  
- **Kerberoasting**: Requesting service tickets for SPNs (Service Principal Names) and cracking them offline.  
  ```powershell
  GetUserSPNs.py -request 'DOMAIN/USER:Password@DC'
  ```
- **AS-REP Roasting**: Extracting TGTs for users with `Do not require Kerberos pre-authentication` enabled.  

#### **(3) Pass-the-Hash/Ticket Attacks**  
- Using stolen NTLM hashes or Kerberos tickets (`TGT`, `TGS`) to authenticate without passwords:  
  ```bash
  mimikatz.exe "sekurlsa::pth /user:Admin /domain:corp.local /ntlm:HASH"
  ```

#### **(4) Exploiting Vulnerable Services & Binaries**  



Attackers often exploit misconfigured or vulnerable services running with high privileges (e.g., `SYSTEM`, `Local Admin`). Common techniques include:  

- **Unquoted Service Paths**:  
  - If a service path is unquoted (e.g., `C:\Program Files\Vulnerable Service\service.exe`), Windows searches for executables in alternate paths (`C:\Program.exe`, `C:\Program Files\Vulnerable.exe`).  
  - Attackers place a malicious binary in a writable directory to hijack execution.  
  ```powershell
  sc query state= all | findstr "SERVICE_NAME"  
  sc qc "ServiceName"  # Check if path is unquoted  
  ```

- **Weak Service Permissions**:  
  - If a service has weak permissions (`Everyone: Modify`), attackers can replace the binary.  
  ```powershell
  accesschk.exe /accepteula -uwcqv "Users" *  
  sc config "ServiceName" binPath= "C:\malicious.exe"  
  ```

- **DLL Hijacking**:  
  - Services loading DLLs from insecure locations can be exploited by planting malicious DLLs.  

---

### **(5) Token Impersonation & Potato Attacks**  

- **SeImpersonatePrivilege Abuse**:  
  - Services running as `LOCAL SERVICE` or `NETWORK SERVICE` often have this privilege, allowing impersonation of other users.  
    ```powershell
    whoami /priv | findstr "Impersonate"  
    ```
- **Potato Attacks (Rotten, Juicy, etc.)**:  
  - Exploits Windows authentication protocols (NTLM, HTTP->SMB relay) to escalate privileges. Examples:  
    - **PrintSpooler + JuicyPotato**: Coerces authentication via printer bugs.  

---

### **(6) Credential Dumping**  

Extracting credentials from memory, LSASS, or registry hives:  

- **Mimikatz**: Extracts plaintext passwords/NTLM hashes from LSASS.  
  ```bash
  mimikatz.exe "sekurlsa::logonpasswords"  
  ```
- **LSASS Dumping**: Creating memory dumps for offline extraction.  

- **Registry Hives Extraction**:  
  - SAM, SYSTEM, and SECURITY hives contain cached credentials and secrets.  
  ```powershell
  reg save HKLM\SAM sam.bak  
  reg save HKLM\SYSTEM system.bak  
  reg save HKLM\SECURITY security.bak  
  ```
- **DPAPI Abuse**:  
  - Extracting saved credentials from Windows Credential Manager (`CredEnumerateW`).  

---

### **(7) Exploiting Scheduled Tasks & WMI**  

- **Scheduled Tasks with Elevated Privileges**:  
  - If a task runs as `SYSTEM` and points to a writable script/binary, attackers can replace it.  
  ```powershell
  schtasks /query /fo LIST /v | findstr "Run As"  
  ```
- **WMI Event Subscription Attacks**:  
  - Persistence/privilege escalation via malicious WMI filters.  

---

## **2. Lateral Movement Techniques**  

Once initial access is gained, attackers move laterally using:  

### **(1) Pass-the-Hash (PtH)**  
```bash
psexec.py -hashes 'LMHASH:NTHASH' DOMAIN/User@TargetIP
```

### **(2) Pass-the-Ticket (PtT)**  
```bash
mimikatz.exe "kerberos::ptt C:\Temp\admin.kirbi"
```

### **(3) Remote Service Execution (PsExec, WinRM, RDP)**  

---

## **3. Defensive Measures**  

- **Least Privilege Principle**: Restrict admin rights.  
- **Regular AD Audits**: Check ACLs, GPOs, and service permissions.  
- **Enable LSA Protection & Credential Guard**.  

