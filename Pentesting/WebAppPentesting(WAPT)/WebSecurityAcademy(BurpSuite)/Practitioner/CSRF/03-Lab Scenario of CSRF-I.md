## CSRF vulnerability with no defenses

This lab's email change functionality is vulnerable to CSRF.
### Objective
	1. Craft some HTML that uses a CSRF attack to change the viewer's email address and upload it to your exploit server.
	2. Hint: You cannot register an email address that is already taken by another user. If you change your own email address while testing your exploit, make sure you use a different email address for the final exploit you deliver to the victim.

### Credentials
	1.Username: wiener
	2.Password: peter

### Access the Lab:

 ```Copy
https://portswigger.net/web-security/learning-paths/csrf/csrf-how-to-construct-a-csrf-attack/csrf/lab-no-defenses#
```

## Step by step walkthrough of Lab

	1.We get a website with a page like this:
	
![[CSRF-01.png]]

	2.As we know the vulnerability lies in the update email function lets go directly to My account.

![[CSRF-02.png]]

	3.We have a login screen here lets use the default creds given to us.

![[CSRF-03.png]]
	4.Here whatever email we provide it will get changed if the session cookie is verified,lets check the burp request after requesting for an email change.


```Burp
POST /my-account/change-email HTTP/1.1
Host: 0a76007e047e4d3980ee0dd000150096.web-security-academy.net
Cookie: session=O5pjwIZh3kRuMmDnlREn568LPORTJgWw
User-Agent: Mozilla/5.0 (X11; Linux x86_64; rv:128.0) Gecko/20100101 Firefox/128.0
Accept: text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8
Accept-Language: en-US,en;q=0.5
Accept-Encoding: gzip, deflate, br
Referer: https://0a76007e047e4d3980ee0dd000150096.web-security-academy.net/my-account?id=wiener
Content-Type: application/x-www-form-urlencoded
Content-Length: 24
Origin: https://0a76007e047e4d3980ee0dd000150096.web-security-academy.net
Upgrade-Insecure-Requests: 1
Sec-Fetch-Dest: document
Sec-Fetch-Mode: navigate
Sec-Fetch-Site: same-origin
Sec-Fetch-User: ?1
Priority: u=0, i
Te: trailers
Connection: close

email=0mni@deuss.space
```

	5.Here we can see that the website is sending email as a POST request in body for changing the Email of that particular authenticated user.
	
![[CSRF-04.png]]
	6.Now Lets go to the exploit server.
![[CSRF-05.png]]
	7. Here everything is already set what we need to do is set the body parameter in such a way that when the user clicks on the crafted email it gets opened in their browser and the email changes to the attackers email.
